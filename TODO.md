# 《入门精要》 的 Shader 修改

## 高斯模糊的性能优化

### 加大步长

现在的高斯模糊是精确到像素的模糊，这种模糊的效果是最标准的，但代价是每个像素都要付出模糊总距离内所有像素数的计算量。

那么做一种假设，只要把步长改为两个像素，计算量就会直接减半，对于足够高分辨率的电脑来说这种效果难以察觉。


### 使用比例步长

之前对计算量的计算有误，假设模糊距离是比例的 b 在分辨率为 a 的屏幕上，计算量为 a*a * a*b*2 （屏幕本身有一个像素就是一次计算，垂直水平两次计算是 a*b*2）

而假设分辨率提高到了 2a，计算量就成为了 2a*2a * 2a*b*2，实际上计算量是八倍，也就是说每次分辨率整体加倍带来的是接近三倍的计算量增加

那么如果改为使用比例步长，每次的步长都是按照比例进行，则无论分辨率所有屏幕在模糊上的计算量都相同，计算量就完全等价于总像素数，不会屏幕越大计算量指数增加

但这样有一种隐患，因为按照比例步长则屏幕越大步长越大，当屏幕足够大时就能够看到多次重叠产生的虚影，这个问题在比例步长无法解决


### 使用降采样

考虑到模糊本身不要求多么精确的结果，降采样是一个可以采用的方案

如果在进行模糊之前把输入的长宽都减半，则只需要进行 1/4 的计算就足以进行模糊

考虑到还有微调的需要，降采样造成的整体模糊可能无法处理微调，可以引入图像融合思路，将模糊后的图片和原图进行合并，只要总比例是 1 就不会有颜色叠加导致的亮度问题
